# Environment 环境模块分析

## 子模块文档

| 子模块 | 说明 |
|--------|------|
| [Current 洋流模块](Current.md) | 模拟环境中的恒定水流（洋流），提供水流速度向量 |
| [Earth 地球参数模块](Earth.md) | 提供地球物理常数（如重力加速度）和坐标基准信息 |
| [Water 水体参数模块](Water.md) | 提供水体介质的物理属性（如水的密度等） |

## 模块功能概述

**Environment（环境）**模块用于集中管理和输出仿真所需的环境参数。现实中船舶运动会受到周围环境的显著影响，包括：重力和地球参考系、水介质的物理特性，以及海流（洋流）的存在等。Environment模块将这些因素封装为子模块，便于在仿真中统一配置和调整。

具体来说：

- **Earth子模块**提供全局的环境常量，如重力加速度，以及定义惯性参考系的方向。这确保仿真中重力方向和大小一致（例如在NED坐标系中$g=9.81\ \text{m/s}^2$指向垂直向下）。

- **Water子模块**提供水介质的参数，如水密度$\rho$（影响浮力和附加质量计算），可能还有其它与水有关的常数如运动粘度等。

- **Current子模块**提供环境洋流速度，可以认为是一个恒定的水流矢量。该矢量用于计算船体**相对水流**的运动（即相对流速），从而影响阻力和附加力的计算。例如，当存在洋流时，船相对于静水的速度需要减去洋流速度得到相对速度，用于阻力模型。

通过Environment模块，用户可以方便地修改环境设置（如改变水流速度方向/大小、改变水密度以模拟淡水/海水等）。这些环境输出被作为信号输入到船体动力学模型相关模块中：

- 重力加速度用于计算船舶重力和浮力（静水恢复力模块需要$g$）。
- 水密度用于计算浮力、附加质量力和阻尼力（这些力通常与$\rho$成正比）。
- 洋流速度用于Relative Velocity模块计算船体相对于水的运动，以及由此产生的阻力、横流力等。

总之，Environment模块为整船动力学仿真提供了统一的"环境背景"。在仿真过程中，这些环境信号通常被视为外部定常输入，不随时间变化（除非特别设置情景变化），从而模拟恒定环境条件下船舶的运动。

## 输入输出信号

### 输入

Environment模块通常没有显式动态输入——它更多地扮演参数提供者的角色。环境参数一般来自配置文件或场景设定。例如，可通过上层的Scenario模块或Simulink参数设置洋流速度值、重力选项等。一旦仿真开始，这些参数视为常值信号。本模块也不接收来自其他模块的信号，保证其独立性。

### 输出

Environment模块向外部提供多路环境信号：

- **Gravity (重力加速度)：** 地球模块输出重力加速度常数$g$，在采用北东地下(NED)惯性系时，该输出可能是一个三维向量$(0,\ 0,\ g)^T$（指向下方）或者标量$g$由静力模块自行定义方向使用。

- **Water Density (水密度)：** 水体模块输出水的密度$\rho$（单位kg/m³）。此输出被传递给浮力、阻尼等计算模块。

- **Current Velocity (洋流速度)：** 洋流模块输出环境水流的速度矢量$\mathbf{v}_{curr}$，通常在惯性坐标系中给定（例如[N, E, D]方向分量）。例如，可设定东向洋流2m/s则$\mathbf{v}_{curr}=(0,\ 2,\ 0)$ m/s。该输出将用于计算船体相对水的速度。

这些输出信号通常被汇总为总线或分别连接到需要的模块输入。例如：

- **Relative Velocity**模块会获取$\mathbf{v}_{curr}$以及船体自身速度来计算相对流速。
- **Hydrostatic**模块获取$g$和$\rho$用于浮力$F_b=\rho g V$等计算。
- **Hydrodynamics/Damping**模块获取$\rho$用于阻力公式$F_D \propto \tfrac{1}{2}\rho C_D A v^2$等计算。

## 核心公式和参数

Environment模块本身主要输出常数或矢量值，内部没有复杂计算，但了解这些参数的物理含义很重要：

### 重力加速度 $g$

通常取$9.81\ \text{m/s}^2$（地球标准重力）。在仿真中假定恒定不变，并指向惯性坐标系的负垂直方向。若采用NED惯性系，则重力矢量为$(0,\ 0,\ 9.81)$（m/s²，向下）。

### 水密度 $\rho$

典型海水密度约$1025\ \text{kg/m}^3$（淡水约$1000\ \text{kg/m}^3$）。密度影响浮力计算（浮力$= \rho g V_{\text{disp}}$）和任何与流体动力相关的力。仿真中通常假设均匀不随深度变化的密度。

### 洋流速度 $\mathbf{v}_{curr}$

可以由给定的流速和方向确定。例如给定流速大小$V_c$和方向方位角$\beta$（相对于北方向），则水平分量可计算为：

$$v_{curr,N}=V_c\cos\beta, \quad v_{curr,E}=V_c\sin\beta$$

垂直分量通常为0（假设水平恒流）。洋流被视为一个恒定的速度场，物体相对于地面有速度$\mathbf{v}$时，相对水流速度：

$$\mathbf{v}_{rel} = \mathbf{v} - \mathbf{v}_{curr}$$

以上这些参数在仿真初始化时由用户设定。一旦设定，它们在Environment模块输出后通常在整个仿真过程中保持不变（除非在Scenario中设计了随时间变化的环境事件，此处暂不考虑）。

## 环境参数对仿真的影响

Environment模块提供的参数是整个仿真系统的基础，它们影响：

- **船体运动轨迹**：流场速度和方向直接改变船体的运动路径
- **动力性能**：水的密度影响推进效率和机动性能
- **稳定性**：重力加速度和水密度共同决定船体的稳性特性
- **能耗**：流场和水动力特性影响推进器的功率需求

## 使用建议

1. **流场设置**：
   - 根据实际海域的海流数据设置流速和流向
   - 考虑潮汐、风驱流等因素的影响
   - 在控制算法测试时，可设置不同流况以验证鲁棒性

2. **水密度设置**：
   - 淡水环境使用 1000 kg/m³
   - 海水环境使用 1025 kg/m³
   - 特殊水域可根据实测数据调整

3. **重力加速度设置**：
   - 一般仿真使用标准值 9.81 m/s²
   - 高精度仿真可根据地理位置修正
