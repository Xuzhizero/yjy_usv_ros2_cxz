# Inertials 惯性矩阵模块分析

## 模块功能说明

**Inertials（惯性矩阵）**模块输出船体的总惯性矩阵$M$，供6DOF动力学方程使用。总惯性矩阵也称质量矩阵，包含了船体刚体质量和附加质量两部分之和。在6DOF方程$(M_{RB}+M_A)\dot{\nu}=\tau_{\text{net}}$中，它是左侧乘于加速度的矩阵。

本模块的主要功能：

- **获取刚体惯性矩阵 $M_{RB}$：** 这包括船体自身和载荷的质量、质心、转动惯量等形成的6×6矩阵。通常已由前级处理模块计算好。

- **获取附加质量矩阵 $M_A$：** 由水动力学模块/参数提供，反映船周围附加加速的流体质量。

- **求和得到总惯性矩阵 $M = M_{RB} + M_A$：** 将两者矩阵对应元素相加，得到综合惯性矩阵。

因为$M_{RB}$和$M_A$都是对称正定矩阵，求和后$M$也是对称正定的6×6矩阵。这个矩阵在模拟中通常保持常值（如果假定船刚体和附加质量不随姿态或速度变化）。

值得注意的是，这个模块本身不计算新矩阵，只是组合已有结果，**以减少在6DOF模块内部重复计算开销**。这样设计使得6DOF模块每个仿真步骤只需矩阵求逆而无需更新矩阵内容（如果$M$固定），提高了仿真效率。

## 输入输出端口

### 输入

- **Rigid-Body Inertia (刚体惯性矩阵)**：6×6矩阵信号，来自前级计算的船体+载荷刚体惯性矩阵。可能由Input Processing模块中的"Inertial Matrix (hull & payload) in CO"或"MRB_CG"计算提供。

- **Added Mass Inertia (附加质量矩阵)**：6×6矩阵信号，来自Hydrodynamics模块或Input Processing模块的附加质量计算部分（如"Added Mass"子模块）。这矩阵典型由实验或理论给定，仿真中当作常数。

### 输出

- **Total Inertia Matrix $M$ (总惯性矩阵)**：6×6矩阵，即将输入的刚体惯性和附加质量矩阵元素相加得到的新矩阵。此输出连接到6DOF模块的"Inertials"输入端口。6DOF模块对其求逆用于计算加速度$\dot{\nu}=M^{-1}\tau$。

由于Simulink中直接传递矩阵信号，Inertials模块可能利用一个矩阵加法器实现$M = M_{RB} + M_A$。如果刚体和附加质量矩阵在Input Processing中已经相加完成，则Inertials模块可能退化为简单的总线/线传递模块。

## 相关背景与公式

### 惯性矩阵形式

对于6DOF船体，惯性矩阵通常写成分块形式：

$$M = \begin{pmatrix} m_{tot} I_{3} & -m_{tot} S(\mathbf{r}_G) \\ m_{tot} S(\mathbf{r}_G) & I_{G,CO} \end{pmatrix} + M_A$$

其中：
- $m_{tot}$是总质量
- $\mathbf{r}_G$是质心在参考坐标系CO中的位置向量
- $S(\mathbf{r}_G)$是对应的反对称矩阵
- $I_{G,CO}$是总刚体绕CO点的转动惯量张量（3×3）
- $M_A$为附加质量矩阵，同样是6×6

### 各部分来源

- 刚体部分$M_{RB}$由Input Processing组合载荷和船体得到
- 附加质量$M_A$由水动力数据给定。例如：
  - 刚体质量部分：$m_{tot}=m_h + m_p$
  - 刚体质心：$\mathbf{r}_G$已校正载荷偏移
  - 刚体惯量：$I_{G}$（质心系）或$I_{CO}$（原点系），通过平行轴定理换算
  - 附加质量：例如对称矩阵对角可能是$X_{\dot{u}}, Y_{\dot{v}}, Z_{\dot{w}}, K_{\dot{p}}, M_{\dot{q}}, N_{\dot{r}}$等

### 总惯性的物理意义

$M$中的对角项代表对各自由度加速阻抗，如$m_{tot}+X_{\dot{u}}$是船首向加速所需总附加质量，$I_{xx}+K_{\dot{p}}$是横滚加速需的总转动惯量等。非对角项如$m_{tot} x_G$（质心偏移引起）或附加质量耦合项表示不同运动耦合惯性。

在仿真过程中，通常$M$被假定常量矩阵。因此Inertials模块的输出不会随时间变——这在Simulink中相当于Constant源（假设载荷不变、附加质量不变）。6DOF模块每个时间步使用相同$M$计算即可。

## 总结

Inertials模块通过汇总质量惯性信息，保证6DOF求解器拿到的矩阵是完整准确的。它本身简单，但其输出$M$在动力学方程中至关重要，决定了相同力作用下产生加速度的大小（质量越大，加速度越小）。正确计算$M$也确保了科氏力等相关计算的一致性。
