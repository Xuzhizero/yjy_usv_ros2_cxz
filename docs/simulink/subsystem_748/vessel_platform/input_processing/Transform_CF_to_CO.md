# Transform CF to CO 浮心到原点坐标变换模块分析

## 模块功能说明

**Transform CF to CO（Center of Flotation to Coordinate Origin）**模块将定义在浮心（CF）处的参数转换到坐标原点（CO）处。浮心是水线面的几何中心，是静水力恢复刚度自然定义的参考点，但动力学计算通常以CO为参考点进行。

### 为什么需要这个转换？

静水恢复刚度矩阵$G$最初是在浮心CF处定义的，因为：
- 垂荡运动以CF为中心
- 横摇和纵摇的恢复力矩以CF为参考计算

但6DOF动力学方程使用CO作为统一参考点，因此需要将$G_{CF}$转换到$G_{CO}$。

## 输入输出端口

### 输入

| 端口 | 变量名 | Simulink信号名 | 物理含义 | 单位 |
|------|--------|----------------|----------|------|
| 1 | $\mathbf{r}_{CF}$ | LCF | 浮心CF相对于CO的位置向量 | m |
| 2 | 0 | Constant | 占位常量 | - |

### 输出

| 端口 | 变量名 | Simulink信号名 | 物理含义 | 单位 |
|------|--------|----------------|----------|------|
| 1 | $H$ | H | 6×6坐标变换矩阵 | - |

## Simulink变量对应关系表

| 物理量符号 | Simulink变量名 | 计算公式/来源 | 说明 |
|------------|----------------|---------------|------|
| $\mathbf{r}_{CF}$ | LCF | 输入端口1 | 浮心位置向量 |
| $S(\mathbf{r}_{CF})$ | Smtrx输出 | 反对称矩阵构造 | 叉乘矩阵 |
| $I_3$ | eye(3) | 3×3单位矩阵 | 矩阵块 |
| $0_{3\times3}$ | zeros(3,3) | 3×3零矩阵 | 矩阵块 |
| 上半部分 | Matrix Concatenate输出 | $[I_3; S(\mathbf{r}_{CF})]$ | 左列 |
| 下半部分 | Matrix Concatenate1输出 | $[0_{3\times3}; I_3]$ | 右列 |
| $H$ | Matrix Concatenate2输出 | 6×6矩阵 | 最终变换矩阵 |
| $H^T$ | Transpose输出 | $H$ 的转置 | 用于刚度变换 |

**说明**：该模块实际输出的是变换矩阵 $H$，刚度矩阵的变换 $G_{CO} = H^T G_{CF} H$ 在外部（上层模块）通过Matrix Multiply完成。

## 核心计算公式

### 坐标变换原理

刚度矩阵的参考点变换遵循以下规则：

$$G_{CO} = H^T G_{CF} H$$

其中$H$是从CO到CF的变换矩阵：

$$H = \begin{pmatrix}
I_3 & 0_{3\times3} \\
S(\mathbf{r}_{CF}) & I_3
\end{pmatrix}$$

$S(\mathbf{r}_{CF})$是$\mathbf{r}_{CF}$的反对称矩阵：

$$S(\mathbf{r}) = \begin{pmatrix}
0 & -z & y \\
z & 0 & -x \\
-y & x & 0
\end{pmatrix}$$

### 展开计算

对于典型的恢复刚度矩阵$G_{CF}$：

$$G_{CF} = \begin{pmatrix}
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & G_{33} & 0 & G_{35} & 0 \\
0 & 0 & 0 & G_{44} & 0 & G_{46} \\
0 & 0 & G_{53} & 0 & G_{55} & 0 \\
0 & 0 & 0 & G_{64} & 0 & G_{66}
\end{pmatrix}$$

变换后$G_{CO}$会在更多位置产生非零元素，因为平移产生了额外的耦合项。

### 简化情况

对于对称船体，浮心通常在纵中线上（$y_{cf} = 0$），且往往接近CO（$x_{cf}, z_{cf}$较小），此时变换相对简单：

$$G_{CO} \approx G_{CF} + \text{小修正项}$$

## 物理意义

### 浮心与坐标原点的关系

| 参考点 | 定义 | 典型位置 |
|--------|------|----------|
| CO（坐标原点） | 船体坐标系原点 | 船中、水线、龙骨交点 |
| CF（浮心） | 水线面几何中心 | 通常在CO附近，但可能略有偏移 |

### 耦合效应

当CF与CO不重合时：
- 垂荡运动会引起纵摇力矩（如果$x_{cf} \neq 0$）
- 横摇运动会引起横荡力（如果$y_{cf} \neq 0$）

这些耦合反映在$G_{CO}$的非对角元素中。

## 计算示例

假设：
- 浮心位置：$\mathbf{r}_{CF} = (1, 0, -0.5)^T$ m（CF在CO前方1m、下方0.5m）
- $G_{CF}$中的主要恢复刚度：$G_{33} = 50000$ N/m, $G_{44} = 100000$ N·m/rad, $G_{55} = 200000$ N·m/rad

则变换矩阵：
$$H = \begin{pmatrix}
1 & 0 & 0 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & 1 & 0 & 0 & 0 \\
0 & 0.5 & 0 & 1 & 0 & 0 \\
-0.5 & 0 & 1 & 0 & 1 & 0 \\
0 & -1 & 0 & 0 & 0 & 1
\end{pmatrix}$$

## 与其他模块的关系

- **G_CF模块**：提供在浮心处定义的恢复刚度矩阵$G_{CF}$
- **Draft模块**：提供浮心高度信息
- **Hydrostatic模块**：使用$G_{CO}$计算静水恢复力

## Simulink实现

```
输入:
  - G_CF (6x6): 浮心处恢复刚度矩阵
  - r_CF (3x1): 浮心相对CO的位置

处理:
  1. 构建反对称矩阵 S(r_CF)
  2. 构建变换矩阵 H
  3. 计算 G_CO = H' * G_CF * H

输出:
  - G_CO (6x6): 坐标原点处恢复刚度矩阵
```

## 注意事项

1. **矩阵对称性**：变换后$G_{CO}$仍应保持对称性

2. **数值精度**：当$\mathbf{r}_{CF}$很小时，变换可能引入数值误差

3. **动态变化**：如果吃水变化导致浮心位置变化，$G_{CO}$也需要更新

4. **验证**：可以通过能量一致性验证变换正确性：$\frac{1}{2}\eta^T G_{CO} \eta = \frac{1}{2}\eta_{CF}^T G_{CF} \eta_{CF}$

## 总结

Transform CF to CO模块确保静水恢复刚度矩阵与动力学方程使用相同的参考点。这种坐标变换是严格的数学操作，保证了物理量的一致性。正确的变换对于准确计算静水力对船舶运动的影响至关重要。
