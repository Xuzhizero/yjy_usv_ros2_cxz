# Added Mass 附加质量模块分析

## 模块功能说明

**Added Mass（附加质量）**模块计算或提供船体在水中加速运动时，因带动周围水体运动而产生的等效惯性质量矩阵$M_A$。附加质量是流体动力学中的重要概念——当船加速时，它不仅需要克服自身惯性，还需要加速其周围的一层流体。这层流体的惯性表现如同给船增加了额外的质量。

### 物理背景

当船体在水中加速时，周围的水也必须跟着加速移动（因为水不能穿透船体）。这部分被加速的水的惯性反作用力作用在船上，其效果等同于船的质量增加了一个"附加质量"。

附加质量的大小取决于：
- **船体形状**：细长体的附加质量较小，宽扁体的附加质量较大
- **运动方向**：不同方向上的附加质量通常不同
- **频率**：高频运动时附加质量可能略有变化，但低频或准静态时可视为常数

### 模块作用

本模块的主要功能是输出6×6附加质量矩阵$M_A$，该矩阵与刚体惯性矩阵$M_{RB}$相加形成总惯性矩阵$M = M_{RB} + M_A$。这一总惯性矩阵用于6DOF动力学方程：

$$(M_{RB} + M_A)\dot{\nu} = \tau_{net} - C(\nu)\nu - D(\nu)\nu + \tau_g$$

## 输入输出端口

### 输入

| 端口 | 变量名 | Simulink信号名 | 物理含义 | 单位 |
|------|--------|----------------|----------|------|
| 1 | $I_g$ | Inertial Matrix (hull and payload) in CO | 船体+载荷在CO坐标系下的转动惯量矩阵（3×3） | kg·m² |

内部使用的常量：
- **mass (kg)**：船体质量 $m$，Simulink中变量名为 `m`

### 输出

| 端口 | 变量名 | Simulink信号名 | 物理含义 | 单位 |
|------|--------|----------------|----------|------|
| 1 | $M_A$ | Added Mass (Hydrodynamics) | 6×6附加质量对角矩阵 | kg, kg·m² |

## Simulink实现结构

### 变量对应关系表

| 物理量符号 | Simulink变量名 | 数据来源 | 说明 |
|------------|----------------|----------|------|
| $m$ | mass (kg) | Constant块（值=m） | 船体质量 |
| $I_g$ | Inertial Matrix (hull and payload) in CO | 输入端口 | 转动惯量矩阵 |
| $I_{xx}$ | Selector输出 | Ig(1,1) | 横摇转动惯量 |
| $I_{yy}$ | Selector1输出 | Ig(2,2) | 纵摇转动惯量 |
| $I_{zz}$ | Selector2输出 | Ig(3,3) | 艏摇转动惯量 |
| $X_{\dot{u}}$ | Xudot | Gain输出 | 纵荡附加质量 |
| $Y_{\dot{v}}$ | Yvdot | Gain2输出 | 横荡附加质量 |
| $Z_{\dot{w}}$ | Zwdot | Gain3输出 | 垂荡附加质量 |
| $K_{\dot{p}}$ | Kpdot | Gain4输出 | 横摇附加惯量 |
| $M_{\dot{q}}$ | Mqdot | Gain5输出 | 纵摇附加惯量 |
| $N_{\dot{r}}$ | Nrdot | Gain6输出 | 艏摇附加惯量 |

### 中间变量计算

本模块使用以下Gain块计算附加质量系数：

**平动附加质量（基于船体质量 m）**：
- Gain（增益=-0.1）：$X_{\dot{u}} = -0.1 \times m$
- Gain2（增益=-1.5）：$Y_{\dot{v}} = -1.5 \times m$
- Gain3（增益=-1）：$Z_{\dot{w}} = -1 \times m$

**转动附加惯量（基于转动惯量矩阵 Ig）**：
- Selector → Gain4（增益=-0.2）：$K_{\dot{p}} = -0.2 \times I_{xx}$，其中 $I_{xx} = I_g(1,1)$
- Selector1 → Gain5（增益=-0.8）：$M_{\dot{q}} = -0.8 \times I_{yy}$，其中 $I_{yy} = I_g(2,2)$
- Selector2 → Gain6（增益=-1.7）：$N_{\dot{r}} = -1.7 \times I_{zz}$，其中 $I_{zz} = I_g(3,3)$

## 核心计算公式

### 计算流程

1. **构造对角向量**：
   通过Mux块将6个附加质量系数组合：
   $$\text{diag\_vector} = [X_{\dot{u}}, Y_{\dot{v}}, Z_{\dot{w}}, K_{\dot{p}}, M_{\dot{q}}, N_{\dot{r}}]$$

2. **创建对角矩阵**：
   通过Create Diagonal Matrix块生成6×6对角矩阵

3. **符号取反**：
   通过Gain1（增益=-1）将矩阵取反，得到最终的附加质量矩阵：
   $$M_A = -\text{diag}([X_{\dot{u}}, Y_{\dot{v}}, Z_{\dot{w}}, K_{\dot{p}}, M_{\dot{q}}, N_{\dot{r}}])$$

### 最终附加质量矩阵

$$M_A = \text{diag}([0.1m, 1.5m, m, 0.2I_{xx}, 0.8I_{yy}, 1.7I_{zz}])$$

展开为：

$$M_A = \begin{pmatrix}
0.1m & 0 & 0 & 0 & 0 & 0 \\
0 & 1.5m & 0 & 0 & 0 & 0 \\
0 & 0 & m & 0 & 0 & 0 \\
0 & 0 & 0 & 0.2I_{xx} & 0 & 0 \\
0 & 0 & 0 & 0 & 0.8I_{yy} & 0 \\
0 & 0 & 0 & 0 & 0 & 1.7I_{zz}
\end{pmatrix}$$

## 附加质量系数的物理意义

| 系数 | Simulink变量 | 计算公式 | 物理含义 |
|------|--------------|----------|----------|
| $-X_{\dot{u}}$ | Xudot | $-0.1 \times m$ | 纵向加速时需额外加速的水质量（约10%船体质量） |
| $-Y_{\dot{v}}$ | Yvdot | $-1.5 \times m$ | 横向加速时需额外加速的水质量（约150%船体质量） |
| $-Z_{\dot{w}}$ | Zwdot | $-1 \times m$ | 垂向加速时需额外加速的水质量（约100%船体质量） |
| $-K_{\dot{p}}$ | Kpdot | $-0.2 \times I_{xx}$ | 横摇角加速时需额外加速的水转动惯量（约20%横摇惯量） |
| $-M_{\dot{q}}$ | Mqdot | $-0.8 \times I_{yy}$ | 纵摇角加速时需额外加速的水转动惯量（约80%纵摇惯量） |
| $-N_{\dot{r}}$ | Nrdot | $-1.7 \times I_{zz}$ | 艏摇角加速时需额外加速的水转动惯量（约170%艏摇惯量） |

## 与其他模块的关系

- **Inertial Matrix (hull and payload) in CO模块**：提供输入 $I_g$
- **Inertials模块**：接收 $M_A$ 与 $M_{RB}$ 相加得到总惯性矩阵 $M$
- **Coriolis模块**：使用 $M_A$ 计算附加质量产生的科氏力 $C_A(\nu)\nu$
- **6DOF模块**：使用总惯性矩阵求解加速度 $\dot{\nu} = M^{-1}\tau_{net}$

## 注意事项

1. **简化模型**：本实现采用简化的比例系数（-0.1, -1.5, -1, -0.2, -0.8, -1.7），适用于快速仿真。实际应用中可根据CFD或实验数据调整。

2. **对角矩阵假设**：本模型假设附加质量矩阵为对角矩阵，忽略了耦合项。

3. **低频近似**：本模型假设附加质量为常数，适用于低频运动。

4. **对称性**：输出的 $M_A$ 为对称正定矩阵。

## 总结

Added Mass模块通过预设的比例系数，将船体质量和转动惯量转换为附加质量矩阵。该模块量化了船体与周围水体的惯性耦合效应，是水动力计算的基础。
