# GM 稳心高度模块分析

## 模块功能说明

**GM（稳心高度）**模块计算船舶的稳心高度，这是评估船舶初稳性的核心指标。GM（Metacentric Height）定义为稳心M到重心G的垂直距离：

$$GM = KB + BM - KG = KM - KG$$

其中：
- $K$：船底基线
- $B$：浮心（排水体积的几何中心）
- $M$：稳心（小角度倾斜时浮心移动轨迹的曲率中心）
- $G$：重心

GM值直接决定了船舶的横摇稳定性和恢复力矩大小。

### 物理意义

当船舶发生小角度横倾（横摇角$\phi$）时，产生的恢复力矩为：

$$M_{restore} = \Delta \cdot GM \cdot \sin\phi \approx \Delta \cdot GM \cdot \phi$$

- **GM > 0**：船舶稳定，倾斜后会产生恢复力矩使其回正
- **GM = 0**：临界稳定状态
- **GM < 0**：船舶不稳定，会继续倾覆

## 输入输出端口

### 输入

| 端口 | 变量名 | Simulink信号名 | 物理含义 | 单位 |
|------|--------|----------------|----------|------|
| 1 | $T$ | T | 吃水深度（来自Draft模块） | m |
| 2 | $\nabla$ | nabla | 排水体积（来自Volume模块） | m³ |
| 3 | $r_g$ | rg | 修正后的重心位置（来自CG corrected for payload模块） | m |

内部使用的常量：

| 常量名 | Simulink变量名 | 说明 |
|--------|----------------|------|
| $I_T$ | Constant7 (值=I_T) | 横向水线面惯性矩 |
| $I_L$ | Constant8 (值=I_L) | 纵向水线面惯性矩 |
| $L$ | length (m) | 船体长度 |
| $B$ | beam pontoon (m) (值=B_pont) | 浮筒宽度 |

### 输出

| 端口 | 变量名 | Simulink信号名 | 物理含义 | 单位 |
|------|--------|----------------|----------|------|
| 1 | $GM_T$ | GM_T | 横向稳心高度 | m |
| 2 | $GM_L$ | GM_L | 纵向稳心高度 | m |

## Simulink变量对应关系表

| 物理量符号 | Simulink变量名 | 计算公式/来源 | 说明 |
|------------|----------------|---------------|------|
| $T$ | T | 输入端口1 | 吃水深度 |
| $\nabla$ | nabla | 输入端口2 | 排水体积 |
| $r_g$ | rg | 输入端口3 | 修正后重心位置向量 |
| $z_G$ | Selector3输出 | rg(3) | 重心z坐标分量 |
| $KB$ | Gain5输出 (名称=KB) | 见下文公式 | 浮心高度 |
| $BM_T$ | Divide6输出 (名称=BM_T) | $I_T / \nabla$ | 横向稳心半径 |
| $BM_L$ | Divide8输出 (名称=BM_L) | $I_L / \nabla$ | 纵向稳心半径 |
| $KG$ | Sum3输出 (名称=KG) | $T - z_G$ | 重心高度 |
| $KM_T$ | Sum1输出 (名称=KM_T) | $KB + BM_T$ | 横向稳心距基线高度 |
| $KM_L$ | Sum2输出 (名称=KM_L) | $KB + BM_L$ | 纵向稳心距基线高度 |
| $GM_T$ | Sum4输出 (名称=GM_T) | $KM_T - KG$ | 横向稳心高度 |
| $GM_L$ | Sum5输出 (名称=GM_L) | $KM_L - KG$ | 纵向稳心高度 |

### Gain块参数

| Gain块 | 增益值 | 作用 |
|--------|--------|------|
| Gain5 | 1/3 | KB计算的系数 |
| Gain6 | 0.5 | KB计算中的中间系数 |
| Gain7 | 5/2 | KB计算中的吃水系数 |

## 核心计算公式

### 横向稳心高度

$$GM_T = KB + BM_T - KG$$

其中稳心半径：

$$BM_T = \frac{I_T}{\nabla}$$

$I_T$为水线面对纵中线（y=0）的面积二次矩：

$$I_T = \int_L \int_{-b(x)}^{b(x)} y^2 \, dy \, dx$$

对于矩形水线面：
$$I_T = \frac{L \cdot B^3}{12}$$

### 纵向稳心高度

$$GM_L = KB + BM_L - KG$$

$$BM_L = \frac{I_L}{\nabla}$$

$I_L$为水线面对横中线（x=0）的面积二次矩。由于船体长度远大于宽度，通常$GM_L >> GM_T$。

### 浮心高度计算（双体船实现）

对于本项目的双体船模型，浮心高度 KB 采用专门针对双体船结构的计算公式：

$$KB = \frac{5}{6}T - \frac{1}{6} \cdot \frac{\nabla}{\text{length} \times \text{beam}}$$

其中：
- $T$ 是吃水深度
- $\nabla$ 是排水体积
- $\text{length}$ 是船体长度
- $\text{beam}$ 是浮筒宽度

**注意**：此公式与传统的单体船近似公式 $KB \approx \frac{T}{2} \cdot C_{KB}$（其中 $C_{KB} \approx 0.52\text{–}0.56$）不同，它针对双体船的几何特性进行了定制计算。

### 重心高度计算

在 Simulink 模型中，重心高度 KG 的计算方式为：

$$KG = T - z_G$$

其中：
- $T$ 是吃水深度
- $z_G$ 是修正后的重心向量 $r_g$ 的 z 坐标分量（通过 Selector3 选取）

**说明**：模型假设载荷的影响已经体现在修正后的重心位置 $r_g$ 中（该值由 "CG corrected for payload" 模块计算得出，计算公式为 $r_g = \frac{m_h \cdot r_{g,h} + m_p \cdot r_p}{m_h + m_p}$），因此只需用吃水深度减去该 z 坐标即可得到 KG。这与传统的质量加权平均公式 $KG = \frac{m_h \cdot z_h + m_p \cdot z_p}{m_h + m_p}$ 在形式上不同，但物理意义等效。

## 与恢复力矩的关系

GM值直接影响静水恢复刚度矩阵$G$中的横摇恢复项：

$$G_{44} = \rho g \nabla \cdot GM_T = \Delta g \cdot GM_T$$

以及纵摇恢复项：
$$G_{55} = \rho g \nabla \cdot GM_L = \Delta g \cdot GM_L$$

这些刚度值进一步用于：
1. 计算静水恢复力矩
2. 确定自然频率（与Natural Frequencies模块配合）
3. 稳性评估

## 对船舶性能的影响

| GM值 | 稳性特征 | 横摇特性 |
|------|----------|----------|
| GM大（>1m） | 高稳性 | 横摇周期短，摇摆剧烈，乘坐不适 |
| GM适中 | 良好稳性 | 横摇平缓，舒适性好 |
| GM小（<0.3m） | 低稳性 | 横摇周期长，有倾覆风险 |
| GM<0 | 不稳定 | 无法自行回正，危险 |

### 自然频率关系

横摇自然频率：
$$\omega_{roll} = \sqrt{\frac{GM_T \cdot g}{r_{44}^2}}$$

其中$r_{44}$是横摇回转半径。可见GM越大，自然频率越高。

## 载荷对GM的影响

当添加载荷时，GM会发生变化：

1. **高位载荷**：$z_p > z_G$ → KG增大 → GM减小 → 稳性降低
2. **低位载荷**：$z_p < z_G$ → KG减小 → GM增大 → 稳性提高
3. **重载荷**：增加排水体积 → BM减小 → 可能降低GM

这就是为什么船舶装载时需要仔细计算载荷位置对稳性的影响。

## 与其他模块的关系

- **Volume模块**：提供排水体积$\nabla$用于计算BM
- **Draft模块**：提供吃水深度$T$用于估算KB
- **CG Corrected模块**：提供修正后的重心位置用于计算KG
- **G_CF模块**：使用GM计算恢复刚度矩阵
- **Natural Frequencies模块**：使用GM计算横摇/纵摇自然频率

## 注意事项

1. **小角度假设**：GM理论基于小角度线性化，大角度倾斜时应使用GZ曲线分析

2. **自由液面效应**：如果船内有自由液面（如燃油舱），会产生等效GM减小：
   $$GM_{eff} = GM - \frac{\rho_l \cdot i}{\Delta}$$
   其中$i$是液面的惯性矩

3. **动态效应**：高速转弯或波浪中，GM可能动态变化

## 总结

GM模块是船舶稳性分析的核心，它将几何参数（浮心、排水体积）与质量分布（重心）结合，给出一个直观的稳性指标。正确的GM计算对于确保船舶安全运行和准确模拟动态响应都至关重要。
