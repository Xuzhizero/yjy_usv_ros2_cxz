# Relative Velocity 相对速度模块分析

## 模块功能说明

**Relative Velocity（相对速度）**模块计算船体相对于水流的速度$\nu_r$。在存在洋流的情况下，水动力（阻尼力、附加质量力等）取决于船体相对于水的运动速度，而非相对于地面的绝对速度。

### 核心概念

船体在惯性系（NED）中的绝对速度为$\nu$，洋流速度为$\nu_c$，则相对速度为：

$$\nu_r = \nu - \nu_c$$

这里的速度都是在船体坐标系（Body Frame）中表达的。

## 输入输出端口

### 输入

| 端口 | 变量名 | Simulink信号名 | 物理含义 | 单位 |
|------|--------|----------------|----------|------|
| 1 | $V_c$ | V_c (Current Speed) | 洋流速度大小 | m/s |
| 2 | $\beta_c$ | beta_c (Current Direction) | 洋流方向角 | rad |
| 3 | $X$ | X (State Vector) | 船体状态向量（包含位置、姿态、速度） | - |

### 输出

| 端口 | 变量名 | Simulink信号名 | 物理含义 | 单位 |
|------|--------|----------------|----------|------|
| 1 | $\nu_r$ | Relative Velocity | 6×1相对速度向量 | m/s, rad/s |

## Simulink变量对应关系表

| 物理量符号 | Simulink变量名 | 计算公式/来源 | 说明 |
|------------|----------------|---------------|------|
| $V_c$ | V_c | 输入端口1 | 洋流速度大小 |
| $\beta_c$ | beta_c | 输入端口2 | 洋流方向角 |
| $\psi$ | Bus Selector输出 | 从X中选取 | 船体航向角 |
| $\beta_c + \psi$ | Add输出 | 相对洋流角 | 洋流相对船体方向 |
| $\cos(\beta_c+\psi)$ | Trigonometric Function输出 | 三角函数 | 投影系数 |
| $\sin(\beta_c+\psi)$ | Trigonometric Function1输出 | 三角函数 | 投影系数 |
| $u_c$ | Product输出 | $V_c \cdot \cos(\beta_c+\psi)$ | 纵向洋流分量 |
| $v_c$ | Product1输出 | $V_c \cdot \sin(\beta_c+\psi)$ | 横向洋流分量 |
| $w_c$ | Constant输出 | 0 | 垂向洋流分量 |
| $\nu_c$ | Mux3输出 | $[u_c, v_c, 0, 0, 0, 0]^T$ | 洋流速度向量 |
| $\nu$ | Mux输出 | 从X1中选取 | 船体绝对速度 |
| $\nu_r$ | Add1输出 | $\nu - \nu_c$ | 相对速度 |

## 核心计算公式

洋流速度从NED系转换到船体系：
$$u_c = V_c \cdot \cos(\beta_c + \psi)$$
$$v_c = V_c \cdot \sin(\beta_c + \psi)$$
$$w_c = 0$$

相对速度：
$$\nu_r = \nu - \nu_c$$

由于洋流通常没有旋转分量，角速度相对值等于绝对值：
$$p_r = p, \quad q_r = q, \quad r_r = r$$

---

## 详细说明

### 相对速度计算

$$\nu_r = \nu - \nu_c$$

分量形式：
$$\begin{aligned}
u_r &= u - u_c \\
v_r &= v - v_c \\
w_r &= w - w_c \\
p_r &= p \\
q_r &= q \\
r_r &= r
\end{aligned}$$

### 洋流速度转换

假设NED系下洋流速度为$(V_N, V_E, V_D)^T$，船体姿态角为$(\phi, \theta, \psi)$，则船体系下洋流速度：

$$\begin{pmatrix} u_c \\ v_c \\ w_c \end{pmatrix} = R_z(-\psi) R_y(-\theta) R_x(-\phi) \begin{pmatrix} V_N \\ V_E \\ V_D \end{pmatrix}$$

对于水面船舶，通常假设$V_D = 0$（无垂向洋流），且$\phi, \theta$很小时：

$$\begin{aligned}
u_c &\approx V_N \cos\psi + V_E \sin\psi \\
v_c &\approx -V_N \sin\psi + V_E \cos\psi \\
w_c &\approx 0
\end{aligned}$$

### 洋流对水动力的影响

阻尼力取决于相对速度：
$$\tau_D = -D(\nu_r)\nu_r$$

科氏力中的附加质量部分也使用相对速度：
$$\tau_{C_A} = -C_A(\nu_r)\nu_r$$

## 相对速度的物理意义

| 场景 | 船体速度$u$ | 洋流$u_c$ | 相对速度$u_r$ | 效果 |
|------|-------------|-----------|---------------|------|
| 顺流航行 | 5 m/s | 2 m/s | 3 m/s | 阻力减小 |
| 逆流航行 | 5 m/s | -2 m/s | 7 m/s | 阻力增大 |
| 横流 | 5 m/s | 0 | 5 m/s | 需要侧向力抵抗 |

### 顺流/逆流效应

在顺流中航行时，相对速度小于绝对速度，船体受到的阻力减小。在逆流中则相反。这解释了为什么船舶在顺流中需要较小的功率就能达到相同的对地速度。

### 横流效应

当存在横向洋流时，即使船体直线前进（$v=0$），相对速度也有横向分量（$v_r = -v_c \neq 0$），会产生横向水动力，需要操舵来保持航向。

## 与其他模块的关系

- **Current模块**：提供洋流速度$\nu_c^{NED}$
- **6DOF模块**：提供船体绝对速度$\nu$和姿态$\eta$
- **Hydrodynamics/Damping模块**：使用$\nu_r$计算阻尼力
- **Hydrodynamics/Coriolis模块**：使用$\nu_r$计算附加质量科氏力

## 在Simulink中的实现

```
输入:
  - nu (6x1): 船体绝对速度
  - eta (6x1): 船体姿态（用于坐标转换）
  - nu_c_NED (3x1): NED系洋流速度

处理:
  1. 使用R_nb(eta)将nu_c_NED转换到船体系
  2. 构建6x1的nu_c向量（角速度部分为零）
  3. 计算nu_r = nu - nu_c

输出:
  - nu_r (6x1): 相对速度
```

## 特殊情况

### 无洋流

当$\nu_c = 0$时，$\nu_r = \nu$，相对速度等于绝对速度。

### 静止漂流

当船体静止（$\nu = 0$）但有洋流时：
$$\nu_r = -\nu_c$$

此时船体相对于水有运动，会受到阻力作用。

### 洋流方向突变

如果洋流方向或大小突然变化，相对速度也会突变，导致瞬态水动力响应。

## 注意事项

1. **坐标系一致性**：确保洋流速度和船体速度在同一坐标系（船体系）中计算

2. **时变洋流**：如果洋流是空间或时间变化的，需要实时更新$\nu_c$

3. **垂向洋流**：在深水中可能存在垂向洋流，对潜航器影响较大，对水面船影响较小

## 总结

Relative Velocity模块是水动力计算的基础输入处理器。通过计算相对速度，模型能够正确反映洋流对船舶运动的影响，包括阻力变化和横向漂移等现象。这对于在实际海洋环境中进行精确仿真至关重要。
