# Vessel Platform 船体平台模块分析

## 子模块文档目录

| 子模块 | 说明 | 文档链接 |
|--------|------|----------|
| 6DOF 六自由度动力学 | 六自由度动力学和运动学求解器，基于合力积分得到船体运动状态 | [6dof/](6dof/) |
| Hydrodynamics 水动力模块 | 计算流体附加质量力、科氏力以及阻尼力等水动力效应 | [hydrodynamics/](hydrodynamics/) |
| Hydrostatic 静水力模块 | 计算浮力及静力恢复力矩（重力-浮力耦合作用） | [hydrostatic/](hydrostatic/) |
| Inertials 惯性矩阵模块 | 输出船体总惯性矩阵（刚体+附加质量），供6DOF方程使用 | [inertials/](inertials/) |
| Initial Conditions 初始条件模块 | 提供仿真初始状态（初始速度、位置、姿态） | [initial_conditions/](initial_conditions/) |
| Input Processing 输入预处理模块 | 根据船体几何和载荷等计算衍生参数 | [input_processing/](input_processing/) |
| Output Processing 输出后处理模块 | 根据仿真状态计算输出量（如航向角、航速等） | [output_processing/](output_processing/) |
| Sum of Forces and Moments 合力汇总模块 | 汇总各来源的力和力矩，输出合力/合力矩给6DOF解算 | [sum_of_forces_and_moments/](sum_of_forces_and_moments/) |
| Thrust 推进力模块 | 根据控制输入计算推进器产生的推力向量 | [thrust/](thrust/) |
| Waves & Crossflow 波浪与横流模块 | 计算波浪作用力及横流诱导的附加阻力等环境附加力 | [waves_and_crossflow/](waves_and_crossflow/) |

## 模块功能概述

**Vessel Platform（船体平台）**模块是整个船舶动力学仿真的核心部分，它内部包含了各类影响船体运动的物理机制，并通过解算器获得船舶运动状态随时间的演化。其主要功能可以概括为：

- 接收来自**Environment环境**模块的环境参数（如水流速度、重力和水密度）以及**Payload载荷**模块的载荷参数（质量和位置），同时应用外部控制输入（推进指令），以构建完整的受力模型。

- 计算各类水动力和静力作用力，包括：附加质量惯性力、科氏惯性力、阻尼阻力、浮力与重力恢复力矩、波浪与横流力等。模型将这些力分别在子模块中计算，以物理分类组织。

- 汇总所有作用力$\tau_{\text{net}}$后，通过**6DOF**子模块对6自由度运动方程进行数值积分，得到船体在三维空间的运动状态（速度、位置、姿态的变化）。

- 将计算得到的状态输出，并经由Output Processing模块计算一些衍生的输出量（如航向角、航速等）用于监测和控制用途。

## 各子模块功能

可以将Vessel Platform理解为一个物理意义上的船舶"数字孪生"：给定初始状态、环境和操纵，模块内部会依据牛顿定律和流体力学经验公式模拟船如何运动。各子模块各司其职：

- **Input Processing**子系统从静态输入（船体和载荷参数）出发，预计算出在仿真中经常用到的参数（例如总惯性矩阵、重心位置、浮性恢复系数等)以供后续模块使用。

- **Hydrodynamics**子系统处理与船相对运动相关的水动力：包括因船动而产生的惯性附加力（附加质量）和阻尼力（粘性阻力等）。

- **Hydrostatic**子系统处理与船姿态和浸没有关的静浮力：当船倾斜或垂直偏离平衡位置时，重力和浮力形成恢复力矩使其回到平衡。

- **Thrust**模块根据控制输入（例如螺旋桨转速或油门指令）计算推进器产生的推力和可能的力矩。

- **Waves & Crossflow**模块为环境诱导力提供接口，例如波浪冲击力、横流作用产生的额外阻力等。

- **Sum of Forces and Moments**模块将上述各模块输出的力/力矩矢量求和，得到作用于船体质心的总合力$\tau_{\text{net}}$。

- **6DOF**模块接受惯性矩阵和$\tau_{\text{net}}$，用6自由度方程求解加速度并积分得到新的速度和位置。同时它借助Kinematics模块将船体速度转换为惯性系下的位置/姿态变化率并积分得到更新的位姿。

- **Output Processing**模块对6DOF的基本输出进行一定处理，得到更直观的航行指标，如航向角、航速等，供监控和控制使用。

## 模块架构图

```
                    ┌─────────────────┐
VesselCommand ─────→│                 │
Payload ───────────→│ Input Processing│──→ νr, Inertials, H, MA, G, ω, T
Environment ───────→│                 │
State [X] ─────────→└─────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ↓                     ↓                     ↓
   ┌─────────┐        ┌────────────────┐    ┌──────────────┐
   │ Thrust  │        │ Waves and      │    │ Hydrodynamics│
   │         │        │ Crossflow      │    │              │
   └────┬────┘        └───────┬────────┘    └──────┬───────┘
        │                     │                    │
        │    ┌────────────────┼────────────────────┤
        │    │                │                    │
        │    │         ┌──────┴──────┐            │
        │    │         │ Hydrostatic │            │
        │    │         └──────┬──────┘            │
        │    │                │                   │
        ↓    ↓                ↓                   ↓
   ┌──────────────────────────────────────────────────┐
   │          Sum of Forces and Moments               │
   └─────────────────────────┬────────────────────────┘
                             ↓
                    ┌─────────────────┐
                    │   6DOF (In CO)  │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │Output Processing│──→ VesselStates
                    └─────────────────┘
```

## 输入输出接口

### 输入

- **环境输入：** 从Environment模块来的信号，包括重力加速度$g$、水密度$\rho$、洋流速度$\mathbf{v}_{curr}$等。这些输入在内部分别路由到Hydrostatic、Hydrodynamics等需要的地方。

- **载荷输入：** 来自Payload模块的载荷质量、位置等，进入Input Processing用于更新惯性和重心。

- **控制输入：** 推进/操纵指令，由上层控制器或ROS接口传入。典型的是螺旋桨转速指令或期望推力。

- **初始状态输入：** 初始速度、初始姿态等作为Initial Conditions模块的参数输入。

### 输出

- **状态输出：** 6DOF模块计算得到的船体状态量，典型包括：船体速度$\nu$（6×1），船体位置和姿态$\eta$（6×1）。

- **派生输出：** Output Processing模块计算出的航向角、航速等标量输出。

## 关键计算与公式

### 总质量矩阵 (Inertials)

$$M = M_{RB} + M_A$$

由刚体质量（含载荷）和附加质量相加得到的$6\times6$矩阵。

### 科氏力与离心力 (Hydrodynamics/Coriolis)

$$\tau_{Coriolis} = C(\nu)\nu$$

其中$C = C_{RB} + C_A$。

### 流体阻尼 (Hydrodynamics/Damping)

$$\tau_D = -D(\nu)\nu$$

若为线性阻尼，$D$是正定对角矩阵。

### 浮力与恢复力矩 (Hydrostatic)

对小角度线性化为：

$$\tau_g = -G\tilde{\eta}$$

$G$是静水恢复刚度矩阵。

### 推进力 (Thrust)

典型螺旋桨推力模型：$X_{prop}=K_T n|n|$

### 合力汇总

$$\tau_{\text{net}} = \tau_{thrust} + \tau_{waves} + (-\tau_{Coriolis}) + (-\tau_{D}) + (-\tau_{g})$$

### 6DOF运动学/动力学积分

$$(M_{RB}+M_A)\dot{\nu} = \tau_{\text{net}}$$

$$\dot{\eta} = J(\eta)\nu$$

前一式解出加速度$\dot{\nu}=M^{-1}\tau_{\text{net}}$并积分得到速度$\nu(t)$；后一式通过姿态变换矩阵$J(\eta)$将速度转换为位置和姿态变化率并积分得到$\eta(t)$。

## 总结

整个流程类似于实际物理：各类力求和→代入$f=ma$求解运动→得到状态→反馈影响力计算，如此循环。**Vessel Platform模块**通过模块化设计，将复杂的船舶动力学划分为可管理的部分，方便调试与拓展。例如，可以单独替换某一模块（如推进力模块）而不影响其他部分，只要接口一致。
