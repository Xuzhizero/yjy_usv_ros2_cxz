# 仿真变量参考

本文档记录 Simulink 仿真模型所使用的工作区变量及其物理含义，并提供从 MATLAB 工作区快速导出变量的方法。

## 变量总览

以下是当前仿真模型使用的主要标量变量：

### 船体几何与物理参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| L | 30.5 | m | 船体水线长，决定尺度、波浪相互作用与航行性能 |
| B | 5.5 | m | 船体型宽（Beam），影响横向稳定性与横摇特性 |
| T_design | 1.05 | m | 设计吃水（Design Draft） |
| m | 90300 | kg | 船体总质量（含载荷） |
| nabla | 88.0976 | m³ | 排水体积（浮力计算的核心参数） |
| LCF | -2.21 | m | 浮心纵向位置（Longitudinal Center of Flotation），相对参考点 |

### 浮筒参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| Aw_pont | 57.8737 | m² | 单个浮筒的湿表面积，用于计算摩擦阻力或粘性阻尼 |
| Aw_total | 115.7475 | m² | 全船总湿表面积（通常为多个浮筒之和），用于总阻力/能耗估算 |
| B_pont | 2.75 | m | 模型中使用的“beam pontoon (m)”几何尺度（与浮筒横向布置尺度一致） |
| Cb_pont | 0.496 | – | 浮筒方形系数（Block Coefficient），反映浮筒体型饱满程度 |
| Cw_pont | 0.69 | – | 浮筒水线面系数（Waterplane Coefficient），影响浮力与纵摇特性 |
| y_pont | 2.75 | m | 浮筒横向位置（相对中线），影响横向稳定性 |

### 惯量与质量修正参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| Delta_m | 20 | kg | 质量修正量或附加质量调节参数（常用于配平或模型校正） |
| I_L | 6502.06 | m⁴ | 纵向水线面惯性矩（用于 GM 等稳性计算，模型内部以 $BM_L=I_L/\\nabla$ 使用） |
| I_T | 52.86 | m⁴ | 横向水线面惯性矩（用于 GM 等稳性计算，模型内部以 $BM_T=I_T/\\nabla$ 使用） |

### 阻尼系数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| R44 | 0.12 | – | 横摇（Roll）阻尼/恢复相关系数 |
| R55 | 0.12 | – | 纵摇（Pitch）阻尼/恢复相关系数 |
| R66 | 0.12 | – | 航向（Yaw）阻尼/恢复相关系数 |

### 控制与运动参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| T_yaw | 18 | s | 航向控制时间常数或偏航响应特征时间 |
| Umax | 10 | m/s | 最大航速上限（控制或物理约束） |
| k_neg | 0.006445 | – | 反向推力系数（反向工况） |
| k_pos | 0.01108 | – | 正向推力系数（正向工况） |
| kappa | 0.1 | – | 曲率/控制权重系数（常用于航迹或转向控制） |
| R_switch_m | 5 | – | 阻尼或控制模型的切换阈值（如速度/转速/工况判断） |

### 推进系统参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| l1 | -1.005 | m | 左推进器横向杠杆臂（按模型坐标系符号约定为负） |
| l2 | 1.005 | m | 右螺旋桨距中轴线距离 |

### 仿真控制参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| StopTime | 200 | s | 仿真结束时间 |
| trim_setpoint | 280 | – | 纵倾/配平控制目标值（可能为角度或控制内部量） |

---

## 变量对三自由度力求解的影响分析

本节分析上述各变量对水平面三自由度（3-DOF）力求解的影响。三自由度指：

- **X (Surge)** - 纵向力
- **Y (Sway)** - 横向力
- **N (Yaw)** - 航向力矩

### 影响总览表

| 变量 | Surge (X) | Sway (Y) | Yaw (N) | 影响机制 |
|------|:---------:|:--------:|:-------:|----------|
| **m** | ✅ | ✅ | ✅ | 惯性矩阵、附加质量 |
| **k_pos** | ✅ | ❌ | ✅ | 推力计算 |
| **k_neg** | ✅ | ❌ | ✅ | 推力计算 |
| **l1, l2** | ❌ | ❌ | ✅ | 偏航力矩杠杆臂 |
| **T_yaw** | ❌ | ❌ | ✅ | 偏航阻尼系数 |
| **Umax** | ✅ | ❌ | ❌ | 纵向阻尼系数 |
| **L, B** | ✅ | ✅ | ✅ | 惯量估算（间接） |
| 其他变量 | ❌ | ❌ | ❌ | 主要影响垂向三自由度或控制逻辑 |

### 详细分析

#### 一、船体几何与物理参数

| 变量 | X | Y | N | 说明 |
|------|:-:|:-:|:-:|------|
| L | ✅ | ✅ | ✅ | 影响纵向阻尼、横向附加质量、艏摇惯量 $I_{zz}$ |
| B | ❌ | ✅ | ✅ | 宽度影响横向阻力和艏摇惯量回转半径 |
| T_design | ❌ | ❌ | ❌ | 吃水主要影响垂向运动 |
| **m** | ✅ | ✅ | ✅ | **核心参数**：决定惯性 $M_{11}=m+0.1m$, $M_{22}=m+1.5m$，影响科氏力 |
| nabla | ❌ | ❌ | ❌ | 排水体积用于浮力计算，与水平面力无关 |
| LCF | ❌ | ❌ | ❌ | 浮心位置主要影响纵摇特性 |

#### 二、浮筒参数

| 变量 | X | Y | N | 说明 |
|------|:-:|:-:|:-:|------|
| Aw_pont | ❌ | ❌ | ❌ | 湿表面积主要用于摩擦阻力估算，当前模型未直接使用 |
| Aw_total | ❌ | ❌ | ❌ | 同上 |
| B_pont | ❌ | ❌ | ❌ | 浮筒几何参数在当前三自由度模型中未直接参与 |
| Cb_pont | ❌ | ❌ | ❌ | 方形系数主要用于排水体积计算 |
| Cw_pont | ❌ | ❌ | ❌ | 水线面系数影响纵摇特性，与水平运动无关 |
| y_pont | ❌ | ❌ | ❌ | 浮筒横向位置主要影响横摇稳定性 |

#### 三、惯量与质量修正参数

| 变量 | X | Y | N | 说明 |
|------|:-:|:-:|:-:|------|
| Delta_m | ⚠️ | ⚠️ | ⚠️ | 微弱影响：修正总质量，但占比极小（20/90300 ≈ 0.02%） |
| I_L | ❌ | ❌ | ❌ | 水线面惯性矩（用于 GM/稳性相关计算），不直接进入水平 3DOF 力求解 |
| I_T | ❌ | ❌ | ❌ | 水线面惯性矩（用于 GM/稳性相关计算），不直接进入水平 3DOF 力求解 |

#### 四、阻尼系数

| 变量 | X | Y | N | 说明 |
|------|:-:|:-:|:-:|------|
| R44 | ❌ | ❌ | ❌ | 专用于横摇（Roll）阻尼 |
| R55 | ❌ | ❌ | ❌ | 专用于纵摇（Pitch）阻尼 |
| R66 | ❌ | ❌ | ⚠️ | 可能用于偏航阻尼，但当前模型主要用 $T_{yaw}$ |

#### 五、控制与运动参数

| 变量 | X | Y | N | 说明 |
|------|:-:|:-:|:-:|------|
| **T_yaw** | ❌ | ❌ | ✅ | **核心参数**：偏航阻尼 $N_r = I_{zz}/T_{yaw}$，$T_{yaw}$ 越大阻尼越小 |
| **Umax** | ✅ | ❌ | ❌ | **核心参数**：纵向阻尼 $X_u = -24.4g/U_{max}$ |
| **k_pos** | ✅ | ❌ | ✅ | **核心参数**：正向推力 $T = k_{pos} \cdot n \cdot |n|$ |
| **k_neg** | ✅ | ❌ | ✅ | **核心参数**：反向推力 $T = k_{neg} \cdot n \cdot |n|$ |
| kappa | ❌ | ❌ | ❌ | 控制算法参数，非动力学参数 |
| R_switch_m | ❌ | ❌ | ❌ | 控制逻辑参数，非动力学参数 |

#### 六、推进系统参数

| 变量 | X | Y | N | 说明 |
|------|:-:|:-:|:-:|------|
| **l1** | ❌ | ❌ | ✅ | **核心参数**：偏航力矩 $M_z = l_1 T_L - l_2 T_R$，杠杆臂越大转向能力越强 |
| **l2** | ❌ | ❌ | ✅ | 同上 |

#### 七、仿真控制参数

| 变量 | X | Y | N | 说明 |
|------|:-:|:-:|:-:|------|
| StopTime | ❌ | ❌ | ❌ | 纯仿真控制参数，不参与物理计算 |
| trim_setpoint | ❌ | ❌ | ❌ | 纵倾控制参数，非水平面运动 |

### 核心参数及其公式

水平面三自由度力求解中最关键的 7 个参数：

| 参数 | 影响的力/力矩 | 计算公式 |
|------|---------------|----------|
| **m** | 惯性矩阵 | $M_{11} = m + 0.1m$, $M_{22} = m + 1.5m$ |
| **k_pos** | 正向推力 | $T = k_{pos} \cdot n \cdot |n|$ (当 n>0) |
| **k_neg** | 反向推力 | $T = k_{neg} \cdot n \cdot |n|$ (当 n<0) |
| **l1, l2** | 偏航力矩 | $N_{thrust} = l_1 T_L - l_2 T_R$ |
| **T_yaw** | 偏航阻尼 | $N_r = I_{zz} / T_{yaw}$ |
| **Umax** | 纵向阻尼 | $X_u = -24.4 \cdot g / U_{max}$ |

### 结论

1. **m（质量）** 是最核心的参数，影响所有三个自由度的惯性
2. **k_pos、k_neg（推力系数）** 直接决定推进器输出，影响纵向力和偏航力矩
3. **l1、l2（杠杆臂）** 决定差速转向的偏航力矩大小
4. **T_yaw** 决定偏航运动的阻尼特性，影响转向响应
5. **Umax** 决定纵向阻力特性，影响最大航速
6. 浮筒参数、吃水、阻尼系数 R44/R55 等主要影响垂向三自由度（Heave/Roll/Pitch），对水平面运动无直接影响

---

## 从 MATLAB 工作区导出变量

在模型参数发生变化后，可使用以下脚本快速导出所有双精度变量（包括标量、向量和矩阵）到 Markdown 文档：

```matlab
% 获取工作区所有变量信息
vars = whos;

% 筛选 double 类型变量
mask = strcmp({vars.class}, 'double');
double_vars = vars(mask);

% 打开文件
fid = fopen('variables.md', 'w');

%% 1. 输出标量
fprintf(fid, '# 标量变量\n\n');
fprintf(fid, '| Name | Value |\n');
fprintf(fid, '|---|---:|\n');

for i = 1:numel(double_vars)
    if isequal(double_vars(i).size, [1 1])
        val = eval(double_vars(i).name);
        fprintf(fid, '| %s | %.15g |\n', double_vars(i).name, val);
    end
end

%% 2. 输出向量
fprintf(fid, '\n# 向量变量\n\n');

for i = 1:numel(double_vars)
    sz = double_vars(i).size;
    % 判断是否为向量（一维非标量）
    if (sz(1) == 1 && sz(2) > 1) || (sz(1) > 1 && sz(2) == 1)
        vec = eval(double_vars(i).name);

        fprintf(fid, '## %s (%dx%d)\n\n', double_vars(i).name, sz(1), sz(2));

        % 如果向量较短，用表格；否则用代码块
        if numel(vec) <= 20
            fprintf(fid, '| Index | Value |\n');
            fprintf(fid, '|---:|---:|\n');
            for j = 1:numel(vec)
                fprintf(fid, '| %d | %.6g |\n', j, vec(j));
            end
            fprintf(fid, '\n');
        else
            fprintf(fid, '```\n');
            fprintf(fid, '%s\n', mat2str(vec, 6));
            fprintf(fid, '```\n\n');
        end
    end
end

%% 3. 输出矩阵
fprintf(fid, '\n# 矩阵变量\n\n');

for i = 1:numel(double_vars)
    sz = double_vars(i).size;
    % 判断是否为矩阵（二维且不是标量或向量）
    if numel(sz) == 2 && sz(1) > 1 && sz(2) > 1
        mat = eval(double_vars(i).name);

        fprintf(fid, '## %s (%dx%d)\n\n', double_vars(i).name, sz(1), sz(2));

        % 如果矩阵较小，用Markdown表格
        if sz(1) <= 10 && sz(2) <= 10
            % 表头
            fprintf(fid, '|');
            for j = 1:sz(2)
                fprintf(fid, ' Col%d |', j);
            end
            fprintf(fid, '\n');

            % 分隔线
            fprintf(fid, '|');
            for j = 1:sz(2)
                fprintf(fid, '---:|');
            end
            fprintf(fid, '\n');

            % 数据行
            for r = 1:sz(1)
                fprintf(fid, '|');
                for c = 1:sz(2)
                    fprintf(fid, ' %.6g |', mat(r,c));
                end
                fprintf(fid, '\n');
            end
            fprintf(fid, '\n');
        else
            % 大矩阵用代码块
            fprintf(fid, '```\n');
            fprintf(fid, '%s\n', mat2str(mat, 6));
            fprintf(fid, '```\n\n');
        end
    end
end

fclose(fid);
disp('所有变量已导出到 variables.md');
```

运行后会在当前目录生成 `variables.md` 文件，包含三个部分：

1. **标量变量** - 以表格形式展示所有标量（1×1）变量
2. **向量变量** - 每个向量单独列出，≤20 个元素用表格展示，>20 个元素用代码块
3. **矩阵变量** - 每个矩阵单独列出，≤10×10 用表格展示，更大矩阵用代码块

示例输出格式：

```markdown
# 标量变量

| Name | Value |
|---|---:|
| B | 5.5 |
| L | 30.5 |
| m | 90300 |
...

# 向量变量

## eta (3x1)

| Index | Value |
|---:|---:|
| 1 | 0 |
| 2 | 0 |
| 3 | 1.5708 |

# 矩阵变量

## M (3x3)

| Col1 | Col2 | Col3 |
|---:|---:|---:|
| 90320 | 0 | 0 |
| 0 | 90320 | 0 |
| 0 | 0 | 1.9808e+05 |
...
```

### 使用说明

1. 在 MATLAB 命令窗口中加载模型并运行初始化脚本
2. 复制上述代码到命令窗口执行
3. 打开生成的 `variables.md` 查看结果
4. 将标量变量的更新数值整理到本文档的"变量总览"部分
5. 向量和矩阵变量可根据需要添加到相应的文档章节中

---

## 相关文档

- [船体规格参数](船体规格参数.md) - 船体尺寸和推力曲线
- [Simulink模型参数解析](Simulink模型参数解析.md) - 初始条件和时间步长结构体
- [惯性参数说明](subsystem_748/vessel_platform/inertials/Overview_inertials.md) - 惯性参数说明
