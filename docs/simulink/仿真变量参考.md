# 仿真变量参考

本文档记录 Simulink 仿真模型所使用的工作区变量及其物理含义，并提供从 MATLAB 工作区快速导出变量的方法。

## 变量总览

以下是当前仿真模型使用的主要标量变量：

### 船体几何与物理参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| L | 30.5 | m | 船体水线长，决定尺度、波浪相互作用与航行性能 |
| B | 5.5 | m | 船体型宽（Beam），影响横向稳定性与横摇特性 |
| T_design | 1.05 | m | 设计吃水（Design Draft） |
| m | 90300 | kg | 船体总质量（含载荷） |
| nabla | 88.0976 | m³ | 排水体积（浮力计算的核心参数） |
| LCF | -2.21 | m | 浮心纵向位置（Longitudinal Center of Flotation），相对参考点 |

### 浮筒参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| Aw_pont | 57.8737 | m² | 单个浮筒的湿表面积，用于计算摩擦阻力或粘性阻尼 |
| Aw_total | 115.7475 | m² | 全船总湿表面积（通常为多个浮筒之和），用于总阻力/能耗估算 |
| B_pont | 0.25 | m | 单个浮筒宽度，用于浮筒水动力或几何建模 |
| Cb_pont | 0.496 | – | 浮筒方形系数（Block Coefficient），反映浮筒体型饱满程度 |
| Cw_pont | 0.69 | – | 浮筒水线面系数（Waterplane Coefficient），影响浮力与纵摇特性 |
| y_pont | 2.75 | m | 浮筒横向位置（相对中线），影响横向稳定性 |

### 惯量与质量修正参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| Delta_m | 20 | kg | 质量修正量或附加质量调节参数（常用于配平或模型校正） |
| I_L | 0.2667 | – | 纵向惯量修正系数（可能用于滚转/纵摇惯量无量纲化） |
| I_T | 0.12 | – | 横向惯量修正系数（可能用于横摇惯量无量纲化） |

### 阻尼系数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| R44 | 0.12 | – | 横摇（Roll）阻尼/恢复相关系数 |
| R55 | 0.12 | – | 纵摇（Pitch）阻尼/恢复相关系数 |
| R66 | 0.12 | – | 航向（Yaw）阻尼/恢复相关系数 |

### 控制与运动参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| T_yaw | 18 | s | 航向控制时间常数或偏航响应特征时间 |
| Umax | 10 | m/s | 最大航速上限（控制或物理约束） |
| k_neg | 0.0064 | – | 负向控制增益或非线性阻尼系数（反向工况） |
| k_pos | 0.0111 | – | 正向控制增益或非线性阻尼系数（正向工况） |
| kappa | 0.1 | – | 曲率/控制权重系数（常用于航迹或转向控制） |
| R_switch_m | 5 | – | 阻尼或控制模型的切换阈值（如速度/转速/工况判断） |

### 推进系统参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| l1 | 1.005 | m | 左螺旋桨距中轴线距离 |
| l2 | 1.005 | m | 右螺旋桨距中轴线距离 |

### 仿真控制参数

| 变量名 | 数值 | 单位 | 物理含义说明 |
|--------|-----:|------|--------------|
| StopTime | 200 | s | 仿真结束时间 |
| trim_setpoint | 280 | – | 纵倾/配平控制目标值（可能为角度或控制内部量） |

---

## 从 MATLAB 工作区导出变量

在模型参数发生变化后，可使用以下脚本快速导出所有双精度变量（包括标量、向量和矩阵）到 Markdown 文档：

```matlab
% 获取工作区所有变量信息
vars = whos;

% 筛选 double 类型变量
mask = strcmp({vars.class}, 'double');
double_vars = vars(mask);

% 打开文件
fid = fopen('variables.md', 'w');

%% 1. 输出标量
fprintf(fid, '# 标量变量\n\n');
fprintf(fid, '| Name | Value |\n');
fprintf(fid, '|---|---:|\n');

for i = 1:numel(double_vars)
    if isequal(double_vars(i).size, [1 1])
        val = eval(double_vars(i).name);
        fprintf(fid, '| %s | %.15g |\n', double_vars(i).name, val);
    end
end

%% 2. 输出向量
fprintf(fid, '\n# 向量变量\n\n');

for i = 1:numel(double_vars)
    sz = double_vars(i).size;
    % 判断是否为向量（一维非标量）
    if (sz(1) == 1 && sz(2) > 1) || (sz(1) > 1 && sz(2) == 1)
        vec = eval(double_vars(i).name);

        fprintf(fid, '## %s (%dx%d)\n\n', double_vars(i).name, sz(1), sz(2));

        % 如果向量较短，用表格；否则用代码块
        if numel(vec) <= 20
            fprintf(fid, '| Index | Value |\n');
            fprintf(fid, '|---:|---:|\n');
            for j = 1:numel(vec)
                fprintf(fid, '| %d | %.6g |\n', j, vec(j));
            end
            fprintf(fid, '\n');
        else
            fprintf(fid, '```\n');
            fprintf(fid, '%s\n', mat2str(vec, 6));
            fprintf(fid, '```\n\n');
        end
    end
end

%% 3. 输出矩阵
fprintf(fid, '\n# 矩阵变量\n\n');

for i = 1:numel(double_vars)
    sz = double_vars(i).size;
    % 判断是否为矩阵（二维且不是标量或向量）
    if numel(sz) == 2 && sz(1) > 1 && sz(2) > 1
        mat = eval(double_vars(i).name);

        fprintf(fid, '## %s (%dx%d)\n\n', double_vars(i).name, sz(1), sz(2));

        % 如果矩阵较小，用Markdown表格
        if sz(1) <= 10 && sz(2) <= 10
            % 表头
            fprintf(fid, '|');
            for j = 1:sz(2)
                fprintf(fid, ' Col%d |', j);
            end
            fprintf(fid, '\n');

            % 分隔线
            fprintf(fid, '|');
            for j = 1:sz(2)
                fprintf(fid, '---:|');
            end
            fprintf(fid, '\n');

            % 数据行
            for r = 1:sz(1)
                fprintf(fid, '|');
                for c = 1:sz(2)
                    fprintf(fid, ' %.6g |', mat(r,c));
                end
                fprintf(fid, '\n');
            end
            fprintf(fid, '\n');
        else
            % 大矩阵用代码块
            fprintf(fid, '```\n');
            fprintf(fid, '%s\n', mat2str(mat, 6));
            fprintf(fid, '```\n\n');
        end
    end
end

fclose(fid);
disp('所有变量已导出到 variables.md');
```

运行后会在当前目录生成 `variables.md` 文件，包含三个部分：

1. **标量变量** - 以表格形式展示所有标量（1×1）变量
2. **向量变量** - 每个向量单独列出，≤20 个元素用表格展示，>20 个元素用代码块
3. **矩阵变量** - 每个矩阵单独列出，≤10×10 用表格展示，更大矩阵用代码块

示例输出格式：

```markdown
# 标量变量

| Name | Value |
|---|---:|
| B | 5.5 |
| L | 30.5 |
| m | 90300 |
...

# 向量变量

## eta (3x1)

| Index | Value |
|---:|---:|
| 1 | 0 |
| 2 | 0 |
| 3 | 1.5708 |

# 矩阵变量

## M (3x3)

| Col1 | Col2 | Col3 |
|---:|---:|---:|
| 90320 | 0 | 0 |
| 0 | 90320 | 0 |
| 0 | 0 | 1.9808e+05 |
...
```

### 使用说明

1. 在 MATLAB 命令窗口中加载模型并运行初始化脚本
2. 复制上述代码到命令窗口执行
3. 打开生成的 `variables.md` 查看结果
4. 将标量变量的更新数值整理到本文档的"变量总览"部分
5. 向量和矩阵变量可根据需要添加到相应的文档章节中

---

## 相关文档

- [船体规格参数](船体规格参数.md) - 船体尺寸和推力曲线
- [Simulink模型参数解析](Simulink模型参数解析.md) - 初始条件和时间步长结构体
- [Inertials变量来源说明](Inertials变量来源说明.md) - 惯性参数说明
