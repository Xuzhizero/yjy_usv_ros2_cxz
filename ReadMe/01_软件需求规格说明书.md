# 软件需求规格说明书
## 无人船多机实时通讯与目标检测系统

**项目名称**: 无人船ROS2多机实时通讯与目标自动检测系统
**文档版本**: v1.0
**编写日期**: 2026-01-23
**编写人**: 项目开发团队

---

## 1. 引言

### 1.1 编写目的
本文档旨在明确无人船(USV)多机实时通讯与目标自动检测系统的功能需求、性能需求和约束条件，为系统设计、开发、测试和验收提供依据。

### 1.2 项目背景
本项目基于ROS2框架，实现研华工控机（Ubuntu）与仿真计算机（Windows）之间的高性能实时数据通信，用于无人船的感知计算和仿真验证。系统通过网线直连实现低延迟、高带宽的数据传输，支持图像数据实时传输和目标自动检测。

### 1.3 术语定义
- **ROS2**: Robot Operating System 2，机器人操作系统第二代
- **DDS**: Data Distribution Service，数据分发服务
- **USV**: Unmanned Surface Vehicle，无人水面艇
- **UE5**: Unreal Engine 5，虚幻引擎5
- **工控机**: 研华工控机，用于感知计算（Ubuntu系统）
- **仿真机**: 仿真计算机（Windows系统）

### 1.4 参考文献
- ROS2 Humble官方文档
- DDS/FastDDS规范文档
- UE5 Simulink接口文档

---

## 2. 系统概述

### 2.1 系统目标
实现两台异构平台（Ubuntu工控机与Windows仿真机）之间的实时数据通信，支持高频图像数据传输（≥30 Hz），实现目标自动检测功能。

### 2.2 系统架构

```
┌─────────────────────────┐         网线直连         ┌─────────────────────────┐
│   研华工控机(Ubuntu)     │    (192.168.100.x)      │   仿真计算机(Windows)    │
│ ─────────────────────── │◄───────────────────────►│ ─────────────────────── │
│ • 感知计算               │                         │ • UE5 3D仿真             │
│ • 目标检测               │      ROS2 DDS通讯        │ • Simulink动力学仿真     │
│ • 图像处理               │                         │ • 图像生成               │
│ • ROS2节点               │                         │ • ROS2节点               │
└─────────────────────────┘                         └─────────────────────────┘
         │                                                     │
         │                   Wi-Fi上网 (172.16.21.x)          │
         └──────────────────────────────────────────────────────┘
```

### 2.3 硬件环境

#### 研华工控机配置
- **CPU**: Intel 12th Gen Core i7-12700 (12核/20线程, 最大4.9GHz)
- **内存**: 31 GB
- **GPU**: NVIDIA GeForce RTX 4060 (8GB显存, CUDA 12.2)
- **GPU算力**: FP32 ~15 TFLOPS, INT8 ~180-200 TOPS
- **操作系统**: Ubuntu 22.04
- **网络**: 有线网卡(eno2) + Wi-Fi

#### 仿真计算机配置
- **操作系统**: Windows 10/11
- **网络**: 有线网卡 + Wi-Fi
- **软件**: UE5, MATLAB/Simulink

---

## 3. 功能需求

### 3.1 网络通信功能 (FR-NET)

#### FR-NET-01: 双网卡独立配置
**优先级**: 高
**描述**: 系统应支持同一台机器上Wi-Fi和有线网卡独立工作，互不干扰。
- Wi-Fi用于外网访问（172.16.21.x网段）
- 有线网卡用于ROS2通信（192.168.100.x网段）

**验收标准**:
- [ ] 有线网络配置为静态IP（192.168.100.1和192.168.100.2）
- [ ] 有线网卡不配置网关
- [ ] Wi-Fi可正常访问互联网
- [ ] 双向ping测试成功

#### FR-NET-02: ROS2 DDS通信
**优先级**: 高
**描述**: 系统应支持ROS2基于DDS的节点自动发现和数据通信。

**验收标准**:
- [ ] 两台机器的ROS2节点可相互发现
- [ ] 支持话题(Topic)订阅和发布
- [ ] 支持服务(Service)调用
- [ ] 数据传输无丢包

#### FR-NET-03: 防火墙配置
**优先级**: 中
**描述**: 系统应正确配置防火墙规则，允许ROS2通信端口。

**验收标准**:
- [ ] Windows防火墙允许ICMP回显请求
- [ ] 有线网络配置为"专用"网络
- [ ] Wi-Fi网络配置为"公用"网络（可选）

### 3.2 图像数据传输功能 (FR-IMG)

#### FR-IMG-01: ROS2图像消息发布
**优先级**: 高
**描述**: 系统应支持将UE5生成的图像通过ROS2 `sensor_msgs/Image`消息发布。

**输入**: UE5渲染的RGB图像（分辨率可配置，如100×100、640×480等）
**输出**: ROS2 Image消息
**约束**: 支持的最大分辨率至少为1920×1080

**验收标准**:
- [ ] 图像数据正确封装为ROS2 Image消息
- [ ] 消息包含正确的header、height、width、encoding、step、data字段
- [ ] 支持RGB、BGR、灰度等多种编码格式

#### FR-IMG-02: 图像数据订阅与解析
**优先级**: 高
**描述**: 工控机端应能正确订阅和解析图像消息。

**验收标准**:
- [ ] 正确接收图像消息
- [ ] 图像数据完整性校验通过
- [ ] 图像显示正常无失真

#### FR-IMG-03: 高频图像传输
**优先级**: 高
**描述**: 系统应支持不低于30 Hz的图像传输频率。

**验收标准**:
- [ ] 实测图像传输频率 ≥ 30 Hz
- [ ] 端到端延迟 < 100 ms
- [ ] 丢帧率 < 1%

### 3.3 目标检测功能 (FR-DET)

#### FR-DET-01: 3D包围盒投影
**优先级**: 中
**描述**: 系统应支持在UE5中对目标物体生成3D包围盒并投影到2D图像平面。

**验收标准**:
- [ ] 能够获取Actor的3D包围盒坐标
- [ ] 3D坐标正确转换为屏幕坐标
- [ ] 包围盒可视化正确

#### FR-DET-02: 目标检测数据发布
**优先级**: 中
**描述**: 系统应将检测到的目标信息通过ROS2消息发布。

**输出格式**: 自定义消息或`vision_msgs/Detection2DArray`
**包含信息**: 目标类别、边界框坐标、置信度

**验收标准**:
- [ ] 目标检测消息正确发布
- [ ] 检测信息准确可靠

### 3.4 节点集成功能 (FR-NODE)

#### FR-NODE-01: 节点生命周期管理
**优先级**: 中
**描述**: 系统应支持ROS2节点的启动、运行、停止。

**验收标准**:
- [ ] 节点启动无报错
- [ ] 节点异常退出时有日志记录
- [ ] 支持通过Launch文件批量启动

#### FR-NODE-02: QoS策略配置
**优先级**: 高
**描述**: 系统应统一配置ROS2 QoS策略，确保发布者和订阅者兼容。

**验收标准**:
- [ ] 使用统一的QoS配置文件
- [ ] 无QoS不兼容警告
- [ ] 支持RELIABLE和BEST_EFFORT两种模式

---

## 4. 性能需求

### 4.1 实时性要求

| 指标 | 要求 | 备注 |
|------|------|------|
| 图像传输频率 | ≥ 30 Hz | 正常工作模式 |
| 端到端延迟 | < 100 ms | 从图像生成到接收 |
| 网络延迟 | < 10 ms | ping RTT |
| 消息丢失率 | < 1% | 在30分钟测试周期内 |

### 4.2 带宽要求

| 分辨率 | 编码 | 理论带宽 | 实际带宽 |
|--------|------|---------|---------|
| 640×480 | RGB8 | ~22 MB/s @ 30Hz | < 30 MB/s |
| 1280×720 | RGB8 | ~66 MB/s @ 30Hz | < 100 MB/s |
| 1920×1080 | RGB8 | ~150 MB/s @ 30Hz | < 200 MB/s |

**网卡要求**: 千兆以太网（1 Gbps）

### 4.3 稳定性要求

- **连续运行时间**: 系统应支持不少于8小时的连续稳定运行
- **故障恢复**: 网络短暂中断（<5秒）后应能自动恢复通信
- **资源占用**: CPU占用率 < 40%，内存占用 < 8GB

---

## 5. 接口需求

### 5.1 ROS2话题接口

| 话题名称 | 消息类型 | 方向 | 频率 | 说明 |
|---------|---------|------|------|------|
| `/camera/image_raw` | sensor_msgs/Image | 仿真机→工控机 | 30 Hz | 原始RGB图像 |
| `/usv/state` | geometry_msgs/Twist | 仿真机→工控机 | 50 Hz | 船体状态 |
| `/usv/control` | geometry_msgs/Twist | 工控机→仿真机 | 50 Hz | 控制指令 |
| `/detections` | vision_msgs/Detection2DArray | 工控机→仿真机 | 10 Hz | 目标检测结果 |

### 5.2 网络接口

| 机器 | 网卡 | IP地址 | 子网掩码 | 用途 |
|------|------|--------|---------|------|
| Ubuntu工控机 | eno2 | 192.168.100.1 | 255.255.255.0 | ROS2通信 |
| Windows仿真机 | 以太网 | 192.168.100.2 | 255.255.255.0 | ROS2通信 |
| Ubuntu工控机 | Wi-Fi | 172.16.21.69 | 255.255.255.0 | 互联网访问 |
| Windows仿真机 | Wi-Fi | 172.16.21.81 | 255.255.255.0 | 互联网访问 |

### 5.3 环境变量接口

```bash
# Ubuntu工控机
export ROS_DOMAIN_ID=10
export CYCLONEDDS_URI=file://$HOME/.config/cyclonedds/cyclonedds.xml
export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp

# Windows仿真机
set ROS_DOMAIN_ID=10
set CYCLONEDDS_URI=file://C:/Users/.../cyclonedds.xml
```

---

## 6. 非功能需求

### 6.1 可维护性
- 代码应遵循ROS2编码规范
- 关键模块需有注释说明
- 配置文件应参数化，便于调整

### 6.2 可扩展性
- 支持添加新的ROS2节点
- 支持扩展到3台及以上机器通信
- 支持更换不同的DDS实现（FastDDS/CycloneDDS）

### 6.3 安全性
- 网络通信限定在专用网段（192.168.100.x）
- 防火墙规则最小化开放端口
- 支持ROS2安全认证（可选）

### 6.4 易用性
- 提供一键启动脚本
- 提供配置向导和检查工具
- 日志输出清晰易读

---

## 7. 约束条件

### 7.1 硬件约束
- 必须使用有线网络连接（网线直连或交换机）
- 网卡需支持千兆以太网
- 工控机需配备NVIDIA GPU用于目标检测

### 7.2 软件约束
- ROS2版本: Humble（推荐）或Foxy
- Ubuntu版本: 22.04 LTS
- Windows版本: 10或11
- UE5版本: 5.x
- MATLAB/Simulink版本: R2022b及以上

### 7.3 开发约束
- 代码使用Git进行版本管理
- 遵循分支管理规范（claude/*分支）
- 提交信息需包含会话链接

---

## 8. 验收标准

### 8.1 功能验收
- [ ] 所有功能需求(FR-XXX)验收标准通过
- [ ] 性能指标满足第4章要求
- [ ] 接口测试通过

### 8.2 文档验收
- [ ] 用户手册完整
- [ ] 配置管理计划执行到位
- [ ] 测试报告完整

### 8.3 演示验收
- [ ] 现场演示双机通信建立过程
- [ ] 现场演示图像实时传输
- [ ] 现场演示目标检测功能

---

## 9. 附录

### 9.1 需求变更历史

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| v1.0 | 2026-01-23 | 初始版本 | 项目团队 |

### 9.2 需求追踪矩阵

| 需求ID | 设计文档 | 测试用例 | 状态 |
|--------|---------|---------|------|
| FR-NET-01 | 网络配置文档 | TC-NET-01 | 已实现 |
| FR-NET-02 | ROS2通信设计 | TC-NET-02 | 已实现 |
| FR-IMG-01 | 图像消息设计 | TC-IMG-01 | 已实现 |
| FR-IMG-03 | 性能测试计划 | TC-PERF-01 | 测试中 |

---

**文档状态**: ✅ 已完成
**审核状态**: 待审核
**批准状态**: 待批准
