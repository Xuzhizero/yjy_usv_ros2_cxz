# 修复日志：纵向阻尼系数 Xu 从常数改为速度依赖查表

## 问题描述

**现象**：总螺旋桨推力达到 1.578×10⁵ N（船只直行）时，damping 也达到这个数值，航速进入平衡状态，但对应的航速是 **12 m/s**，而理论航速应该是 **6 m/s**。

**影响**：稳态航速是理论值的 2 倍，严重影响仿真的物理真实性。

---

## 原因分析

### 1. 原模型的阻尼形式

原 Damping 模块中，纵向阻尼系数 $X_u$ 是一个**常数**，计算公式为：

$$X_u = -\frac{24.4}{U_{\max}} g$$

其中 $g$ 为重力加速度，$U_{\max}$ 为模型设计最大航速（默认 10 m/s）。

这导致纵向阻力 $\tau_{\text{surge}} = -X_u \cdot u$ **随速度线性增长**。

### 2. 实际船体阻力特性

根据 CFD 阻力计算报告（表 3），不同航速下的船舶总阻力如下：

| 航速 (kn) | 阻力 (kN) |
|----------|----------|
| 12 | 16.09 |
| 13 | 19.40 |
| 14 | 23.08 |
| 15 | 27.14 |
| 16 | 31.72 |
| 17 | 35.75 |
| 18 | 40.58 |
| 19 | 43.88 |
| 20 | 48.97 |

分析发现：
- 速度从 12 kn 增到 20 kn（约 ×1.67），阻力从 16.09 kN 到 48.97 kN（约 ×3.04）
- 阻力增长明显比线性更陡，更接近 $R \propto u^2$（包含波阻/兴波效应）

### 3. 问题根源

用常数 $X_u$ 让阻力 $R = -X_u \cdot u$（随速度一次方增长）会导致：
- **高航速段阻力偏小**
- **从而把稳态航速推高**

这正是仿真中"推力与阻尼平衡时速度偏大"的直接原因。

---

## 解决方案

### 方案选择

| 方案 | 描述 | 优缺点 |
|-----|------|-------|
| A | 二次解析式 $-a u|u|$ | 最快、最稳、计算最便宜 |
| B | 一次+二次 $-(bu + au|u|)$ | 低速更贴合 |
| C | 直接查表 | 严格贴合 CFD 曲线，最稳妥 |

**最终选择**：保持原模型结构 $\tau = -X_u(u) \cdot u$，但将 $X_u$ 从常数改为**速度依赖的查表量**。

### 数学关系

将 CFD 阻力转换为等效线性阻尼系数：

$$X_u(u) = \frac{R(u)}{u}$$

于是模型仍保持：

$$\tau_{\text{surge}} = -X_u(u) \cdot u$$

### 低速段外推（0-12 kn）

CFD 数据从 12 kn 开始，低速段（0-12 kn）采用物理合理的外推：

**假设**：低速段总阻力 $R(u) \propto u^2$（粘性阻力主导）

**推导**：
$$X_u(u) = \frac{R(u)}{u} = \frac{k \cdot u^2}{u} = k \cdot u$$

即 **$X_u$ 在低速随速度线性增长**，且在 $u \to 0$ 时趋于 0，不会发散。

**标定**：使用 12 kn 点保证连续性
$$k = \frac{R(12\text{ kn})}{u(12\text{ kn})^2}$$

---

## 实现方法

### 1. MATLAB 变量定义

在 MATLAB 工作区或模型 init 脚本中添加以下代码：

```matlab
% u_bp: breakpoints of surge speed (m/s)
u_bp = [ ...
  0.000000, 0.514444, 1.028888, 1.543332, 2.057776, 2.572220, 3.086664, ...
  3.601108, 4.115552, 4.629996, 5.144440, 5.658884, 6.173328, 6.687772, ...
  7.202216, 7.716660, 8.231104, 8.745548, 9.259992, 9.774436, 10.288880 ...
];

% Xu_tab: equivalent linear surge damping coefficient Xu(u) (N*s/m)
% (0-12 kn extrapolated with R=k*u^2 calibrated at 12 kn; 13-20 kn from CFD Table 3)
Xu_tab = [ ...
  0.000000, 217.197812, 434.395624, 651.593436, 868.791247, 1085.989059, 1303.186871, ...
  1520.384683, 1737.582495, 1954.780307, 2171.978118, 2389.175930, 2606.373742, 2900.816595, ...
  3204.569260, 3517.065673, 3853.675036, 4087.794155, 4382.293203, 4489.261580, 4759.507352 ...
];
```

### 2. Simulink 1-D Lookup Table 配置

#### 表和断点页
| 参数 | 设置值 |
|-----|-------|
| 表维数 | 1 |
| 数据设定 | 表和断点 |
| 断点设定 | 显式值 |
| **表数据** | `Xu_tab` |
| **断点1** | `u_bp` |

#### 算法页
| 参数 | 推荐设置 |
|-----|---------|
| 内插方法 | 线性点-斜率 |
| **外插方法** | **Clip**（推荐先用此值跑通） |
| 索引搜索方法 | 二分搜索 |
| 输入超出范围诊断 | 警告 |

#### 数据类型页
| 参数 | 设置值 |
|-----|-------|
| 内部规则优先级 | 速度 |
| 要求所有输入具有相同数据类型 | 勾选 |
| 锁定数据类型设置 | 勾选 |

### 3. Simulink 连线结构

```
u ──> Lookup(u_bp, Xu_tab) ──┐
                              × ──> Gain(-1) ──> ΣFx
u ──────────────────────────┘
```

**关键点**：
- Lookup Table 输出的是 $X_u(u)$
- 外面再乘一次 $u$
- 最后取负号（阻力方向）

---

## 单位说明

| 变量 | 单位 |
|-----|------|
| `u_bp` | m/s |
| `Xu_tab` | N·s/m |
| 动力学方程 | N、kg、m、s |

---

## 预期效果

修改后：
- 直行稳态航速应接近 **6 m/s**（与理论值一致）
- 阻力随速度非线性增长，更符合实际船体特性
- 数值稳定，适合实时递推仿真

---

## 相关文档

- [Damping(阻尼模块)分析](../../docs/simulink/subsystem_748/vessel_platform/hydrodynamics/Damping(阻尼模块)分析.md)
- [仿真变量参考](../../docs/simulink/仿真变量参考.md)
- [船体水动力参数获取方法](../../docs/simulink/船体水动力参数获取方法.md)
