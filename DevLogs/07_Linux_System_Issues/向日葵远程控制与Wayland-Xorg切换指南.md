# 向日葵远程控制与 Wayland/Xorg 切换指南

**记录日期**: 2026-01-12
**问题类型**: 远程控制软件兼容性 / 显示协议切换
**适用系统**: Ubuntu 22.04+ / 其他使用 GDM 的 Linux 发行版

---

## 目录

- [1. 向日葵客户端更新安装](#1-向日葵客户端更新安装)
  - [1.1 推荐：直接覆盖安装](#11-推荐直接覆盖安装)
  - [1.2 何时需要先卸载](#12-何时需要先卸载)
- [2. Ubuntu 无法被远控问题](#2-ubuntu-无法被远控问题)
  - [2.1 问题原因](#21-问题原因)
  - [2.2 检查当前显示协议](#22-检查当前显示协议)
- [3. 从 Wayland 切换到 Xorg](#3-从-wayland-切换到-xorg)
  - [3.1 方法一：登录界面切换（推荐）](#31-方法一登录界面切换推荐)
  - [3.2 方法二：命令行强制切换（永久）](#32-方法二命令行强制切换永久)
- [4. 切换到 Xorg 的影响分析](#4-切换到-xorg-的影响分析)
  - [4.1 可能的副作用](#41-可能的副作用)
  - [4.2 切换后的利好](#42-切换后的利好)
  - [4.3 总结建议](#43-总结建议)

---

## 1. 向日葵客户端更新安装

### 1.1 推荐：直接覆盖安装

**操作方法**：直接运行下载的最新版安装包进行安装。

**好处**：

- **保留配置**：能够保留原有的识别码（Device ID）、验证码、历史连接记录以及开机自启等设置，省去重新配置的麻烦
- **平滑升级**：安装程序会自动检测旧版本并进行替换

### 1.2 何时需要先卸载

只有在以下少数情况下，才建议先卸载：

| 情况 | 说明 |
|------|------|
| 安装报错 | 直接覆盖安装时提示"文件被占用"或安装失败 |
| 版本跨度极大 | 旧版本非常古老（好几年前），架构可能发生变化 |
| 异常Bug | 旧版本存在严重运行问题，想彻底重置软件环境 |

> **注意**：如果必须卸载且希望保留原来的识别码，在卸载过程中如果出现"是否保留配置/数据"的选项，请务必勾选保留。

---

## 2. Ubuntu 无法被远控问题

### 2.1 问题原因

向日葵（以及很多旧版远程软件）目前对 **Wayland 协议**的支持不够好。Ubuntu 22.04+ 默认使用 Wayland 作为显示协议，这会导致向日葵无法正常远控。

**官方提示**：因为系统默认使用 Wayland，所以需要将选项切换为"Ubuntu on Xorg"，登录系统以后即可正常使用向日葵个人版的远程服务。

### 2.2 检查当前显示协议

#### 方法一：命令行（最快）

打开终端（快捷键 `Ctrl+Alt+T`），输入：

```bash
echo $XDG_SESSION_TYPE
```

**输出解读**：
- `wayland`：正在使用 Wayland（需要切换）
- `x11`：正在使用 Xorg（如果此时向日葵还连不上，可能是其他问题）

#### 方法二：图形界面

打开 **设置 (Settings)** -> **关于 (About)**，在列表中找到 **窗口系统 (Windowing System)** 一栏，会直接显示是 Wayland 还是 X11。

---

## 3. 从 Wayland 切换到 Xorg

### 3.1 方法一：登录界面切换（推荐）

这是最安全的方法，不会破坏系统配置。

**步骤**：

1. **注销**当前账户（Log Out），或者直接**重启**电脑，回到输入密码的登录界面
2. **点击**你的用户名
3. **关键一步**：在输入密码框的**右下角**（或屏幕边缘），会出现一个**齿轮图标 ⚙️**
4. **点击齿轮**，选择 **"Ubuntu on Xorg"**
5. 输入密码登录

> **注**：只要不手动改回去，系统通常会记住这个选择，下次登录默认还是 Xorg。

### 3.2 方法二：命令行强制切换（永久）

如果找不到齿轮图标，或者是服务器环境需要强制所有用户都用 Xorg，可以通过修改配置文件实现。

**步骤**：

1. 打开终端，编辑配置文件：

```bash
sudo nano /etc/gdm3/custom.conf
```

2. 找到以下行：

```ini
#WaylandEnable=false
```

3. 去掉开头的 `#` 号，使其变成：

```ini
WaylandEnable=false
```

4. 保存并退出：
   - `Ctrl+O` 保存
   - `Enter` 确认
   - `Ctrl+X` 退出

5. 重启电脑或重启图形界面服务：

```bash
sudo systemctl restart gdm3
```

---

## 4. 切换到 Xorg 的影响分析

### 4.1 可能的副作用

切换到 Xorg 后可能存在以下体验倒退：

#### 触控板手势变差（笔记本用户注意）

| 协议 | 体验 |
|------|------|
| Wayland | 拥有非常丝滑的、类似 MacBook 的 1:1 触控板手势（如三指上滑进入多任务视图） |
| Xorg | 手势体验相对生硬，需要安装额外插件（如 Touchegg）才能达到类似效果 |

#### 多显示器"混合缩放"支持不佳（最明显的痛点）

| 协议 | 体验 |
|------|------|
| Wayland | 完美支持不同分辨率显示器的独立缩放（如 4K 屏 200%，1080P 屏 100%） |
| Xorg | 只能设置全局缩放比例，混合分辨率场景下可能出现模糊或图标大小异常 |

#### 画面撕裂（Screen Tearing）

| 协议 | 体验 |
|------|------|
| Wayland | 强制垂直同步，基本消除画面撕裂，窗口拖动和视频播放非常平滑 |
| Xorg | 快速拖动窗口、看高帧率视频或玩游戏时，可能出现画面撕裂 |

#### 安全性（理论层面）

| 协议 | 体验 |
|------|------|
| Wayland | 架构上隔离应用程序，A 程序难以窃取 B 程序的屏幕/键盘信息（这也是向日葵无法远控的原因） |
| Xorg | 任何程序都可以监听键盘输入或读取屏幕内容（向日葵能用，但理论上恶意软件也更容易截图） |

### 4.2 切换后的利好

切换回 Xorg 对很多场景反而是提升，因为兼容性更好：

#### 屏幕共享/录制兼容性极佳

除了向日葵，**腾讯会议、Zoom、OBS直播、钉钉**等软件的屏幕共享功能，在 Xorg 下几乎不会出问题。而在 Wayland 下，这些软件经常出现黑屏或无法共享整个桌面。

#### 老旧显卡/NVIDIA 驱动更稳

虽然 NVIDIA 对 Wayland 的支持越来越好，但在某些旧版本驱动或旧显卡上，Xorg 依然是运行最稳定、Bug 最少的环境。

#### 游戏兼容性

部分老游戏在 Xorg 下运行更流畅，且不需要经过 XWayland 转译层。

### 4.3 总结建议

**放心切换**：如果主要用这台电脑办公、写代码、被远程控制，且没有使用复杂的双屏组合（如一个4K+一个1080P），切换到 Xorg 几乎没有肉眼可见的副作用。它非常成熟稳定。

**随时可恢复**：这个切换不是不可逆的。如果发现切换后触控板不好用或屏幕看起来不舒服，只需在登录界面点小齿轮，选回 "Ubuntu"（即 Wayland），一切就会恢复原状。

> **一句话总结**：为了能用向日葵，牺牲一点点触控板手势和理论安全性，是完全值得且常规的操作。

---

## 参考资源

- [How to Switch Between Wayland and Xorg(X11) on Ubuntu - YouTube](https://www.youtube.com/watch?v=example)（视频教程演示登录界面齿轮切换）
